<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ - IITP</title>
    <!-- ì¹´ì¹´ì˜¤ SDK v1.39.10 (login ë©”ì„œë“œ ì§€ì›) -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
            width: 90%;
            margin-bottom: 1rem;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .kakao-btn {
            background-color: #FEE500;
            color: #000;
        }

        .kakao-btn:hover {
            background-color: #FDD835;
            transform: translateY(-2px);
        }

        .signup-btn {
            background-color: #4CAF50;
            color: white;
        }

        .signup-btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .logout-btn {
            background-color: #f44336;
            color: white;
        }

        .logout-btn:hover {
            background-color: #da190b;
            transform: translateY(-2px);
        }

        .info-section {
            background: rgba(255,255,255,0.9);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
            text-align: left;
        }

        .user-info {
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* íšŒì› íƒ€ì… ì„ íƒ ìŠ¤íƒ€ì¼ */
        .member-type-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }

        .member-type-title {
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
            text-align: center;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .radio-item:hover {
            border-color: #4CAF50;
            background: #f0fff0;
        }

        .radio-item.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .radio-item input[type="radio"] {
            width: auto;
            margin: 0;
        }

        /* ê°œì¸ íšŒì› ì „ìš© í•„ë“œ ìŠ¤íƒ€ì¼ */
        .user-fields {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        .user-fields.hide {
            display: none;
        }

        /* ì‚¬ì—…ì ë²ˆí˜¸ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .business-fields {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .business-fields.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .validation-message {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .validation-message.success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .validation-message.error {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .status {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }

        .hidden { display: none; }

        .api-test {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .api-btn {
            background: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .api-btn:hover {
            background: #0056b3;
        }

        pre {
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 5px;
            text-align: left;
            overflow-x: auto;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .check-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .check-btn:hover {
            background: #138496;
        }

        .input-with-check {
            display: flex;
            align-items: center;
        }

        .input-with-check input {
            flex: 1;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="logo">ğŸŒ± IITP</div>
    <div class="subtitle">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</div>

    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="loginSection">
        <button class="btn kakao-btn" onclick="handleKakaoLogin()">
            <span>ğŸ’¬</span>
            ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸í•˜ê¸°
        </button>
    </div>

    <!-- íšŒì›ê°€ì… ì„¹ì…˜ -->
    <div id="signupSection" class="hidden">
        <div class="status info">ì‹ ê·œ íšŒì›ì…ë‹ˆë‹¤. íšŒì› ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

        <!-- íšŒì› íƒ€ì… ì„ íƒ -->
        <div class="member-type-section">
            <div class="member-type-title">íšŒì› ìœ í˜• ì„ íƒ</div>
            <div class="radio-group">
                <div class="radio-item selected" onclick="selectMemberType('user', this)">
                    <input type="radio" name="memberType" value="user" checked>
                    <span>ğŸ‘¤ ê°œì¸ íšŒì›</span>
                </div>
                <div class="radio-item" onclick="selectMemberType('store', this)">
                    <input type="radio" name="memberType" value="store">
                    <span>ğŸª ì‚¬ì—…ì íšŒì›</span>
                </div>
            </div>
        </div>

        <!-- ê°œì¸ íšŒì› ì „ìš© í•„ë“œ -->
        <div id="userFields" class="user-fields">
            <div class="form-group">
                <label for="nickname">ë‹‰ë„¤ì„ *</label>
                <div class="input-with-check">
                    <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <button type="button" class="check-btn" onclick="checkNickname()">ì¤‘ë³µí™•ì¸</button>
                </div>
                <div id="nicknameValidation" class="validation-message" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="phone">ì „í™”ë²ˆí˜¸</label>
                <div class="input-with-check">
                    <input type="tel" id="phone" placeholder="01012345678" pattern="^01[0-9]{8,9}$">
                    <button type="button" class="check-btn" onclick="checkPhone()">ì¤‘ë³µí™•ì¸</button>
                </div>
                <div id="phoneValidation" class="validation-message" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="address">ì£¼ì†Œ *</label>
                <input type="text" id="address" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
        </div>

        <!-- ì‚¬ì—…ì íšŒì› ì „ìš© í•„ë“œ -->
        <div id="businessFields" class="business-fields">
            <div class="form-group">
                <label for="businessPhone">ì „í™”ë²ˆí˜¸</label>
                <div class="input-with-check">
                    <input type="tel" id="businessPhone" placeholder="01012345678" pattern="^01[0-9]{8,9}$">
                    <button type="button" class="check-btn" onclick="checkBusinessPhone()">ì¤‘ë³µí™•ì¸</button>
                </div>
                <div id="businessPhoneValidation" class="validation-message" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="businessLicense">ì‚¬ì—…ì ë²ˆí˜¸ *</label>
                <div class="input-with-check">
                    <input type="text" id="businessLicense" placeholder="123-45-67890"
                           pattern="^\d{3}-\d{2}-\d{5}$|^\d{10}$">
                    <button type="button" class="check-btn" onclick="checkBusinessLicense()">ì¤‘ë³µí™•ì¸</button>
                </div>
                <div id="businessValidation" class="validation-message" style="display: none;"></div>
                <small style="color: #666;">í˜•ì‹: 123-45-67890 ë˜ëŠ” 1234567890</small>
            </div>
        </div>

        <button class="btn signup-btn" onclick="signupUser()">
            íšŒì›ê°€ì… ì™„ë£Œ
        </button>
    </div>

    <!-- ì‚¬ìš©ì ì •ë³´ ì„¹ì…˜ -->
    <div id="userSection" class="hidden">
        <div class="user-info">
            <h3>ë¡œê·¸ì¸ ì„±ê³µ! ğŸ‰</h3>
            <div id="userInfo"></div>
        </div>
        <button class="btn logout-btn" onclick="logout()">
            ë¡œê·¸ì•„ì›ƒ
        </button>
    </div>

    <div id="statusDiv"></div>

    <!-- ë””ë²„ê·¸ ì •ë³´ -->
    <div class="debug-info">
        <strong>ì¹´ì¹´ì˜¤ SDK ìƒíƒœ:</strong> <span id="sdkStatus">ë¡œë”© ì¤‘...</span><br>
        <strong>í˜„ì¬ í† í°:</strong> <span id="tokenStatus">ì—†ìŒ</span><br>
        <strong>SDK ë²„ì „:</strong> <span id="sdkVersion">v1.39.10</span><br>
        <strong>ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ:</strong> <span id="availableMethods">í™•ì¸ ì¤‘...</span>
    </div>
</div>

<div class="info-section">
    <h3>API í…ŒìŠ¤íŠ¸</h3>
    <div class="api-test">
        <button class="btn api-btn" onclick="testSdkStatus()">SDK ìƒíƒœ í™•ì¸</button>
        <button class="btn api-btn" onclick="testNicknameCheck()">ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸</button>
        <button class="btn api-btn" onclick="testPhoneCheck()">ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸</button>
        <button class="btn api-btn" onclick="testEmailCheck()">ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸</button>
        <button class="btn api-btn" onclick="testBusinessLicenseCheck()">ì‚¬ì—…ìë²ˆí˜¸ ì¤‘ë³µ í™•ì¸</button>
        <button class="btn api-btn" onclick="testTokenRefresh()">í† í° ê°±ì‹ </button>
        <button class="btn api-btn" onclick="checkBackendHealth()">ë°±ì—”ë“œ ì—°ê²° í™•ì¸</button>
    </div>
    <div id="apiResult"></div>
</div>

<script>
    let currentAccessToken = null;
    let kakaoInitialized = false;
    let selectedMemberType = 'user'; // ê¸°ë³¸ê°’: ê°œì¸ íšŒì›

    // ì¤‘ë³µ í™•ì¸ ìƒíƒœ ê´€ë¦¬
    let validationStatus = {
        nickname: false,
        phone: false,
        businessPhone: false,
        businessLicense: false
    };

    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”
    window.addEventListener('load', function() {
        console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” ì‹œì‘...');

        if (typeof Kakao !== 'undefined') {
            try {
                Kakao.init("171831cd15632cbfaac40ae9f7604a6f");
                console.log('ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” ì„±ê³µ');
                console.log('ì¹´ì¹´ì˜¤ SDK ë²„ì „:', Kakao.VERSION);
                console.log('ì‚¬ìš© ê°€ëŠ¥í•œ Auth ë©”ì„œë“œ:', Object.keys(Kakao.Auth || {}));

                document.getElementById('sdkStatus').textContent = 'ì´ˆê¸°í™” ì„±ê³µ';
                document.getElementById('availableMethods').textContent = Object.keys(Kakao.Auth || {}).join(', ');
                kakaoInitialized = true;

            } catch (error) {
                console.error('ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                document.getElementById('sdkStatus').textContent = 'ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message;
            }
        } else {
            console.error('ì¹´ì¹´ì˜¤ SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            document.getElementById('sdkStatus').textContent = 'SDK ë¡œë“œ ì‹¤íŒ¨';
        }

        // ê¸°ì¡´ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        const savedToken = localStorage.getItem('accessToken');
        const savedUserInfo = localStorage.getItem('userInfo');

        if (savedToken && savedUserInfo) {
            document.getElementById('tokenStatus').textContent = 'ì €ì¥ëœ í† í° ìˆìŒ';
            showUserSection(JSON.parse(savedUserInfo));
        } else {
            document.getElementById('tokenStatus').textContent = 'ì €ì¥ëœ í† í° ì—†ìŒ';
        }
    });

    // íšŒì› íƒ€ì… ì„ íƒ í•¨ìˆ˜
    function selectMemberType(type, element) {
        selectedMemberType = type;

        // ëª¨ë“  ë¼ë””ì˜¤ ì•„ì´í…œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
        document.querySelectorAll('.radio-item').forEach(item => {
            item.classList.remove('selected');
        });

        // ì„ íƒëœ ì•„ì´í…œì— selected í´ë˜ìŠ¤ ì¶”ê°€
        element.classList.add('selected');

        // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬
        element.querySelector('input[type="radio"]').checked = true;

        const businessFields = document.getElementById('businessFields');
        const userFields = document.getElementById('userFields');

        if (type === 'store') {
            // ì‚¬ì—…ì íšŒì›: ì‚¬ì—…ì í•„ë“œ í‘œì‹œ, ê°œì¸ í•„ë“œ ìˆ¨ê¹€
            businessFields.classList.add('show');
            userFields.classList.add('hide');

            // ê°œì¸ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('nickname').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('address').value = '';
            hideValidation('nicknameValidation');
            hideValidation('phoneValidation');
            validationStatus.nickname = false;
            validationStatus.phone = false;
        } else {
            // ê°œì¸ íšŒì›: ê°œì¸ í•„ë“œ í‘œì‹œ, ì‚¬ì—…ì í•„ë“œ ìˆ¨ê¹€
            businessFields.classList.remove('show');
            userFields.classList.remove('hide');

            // ì‚¬ì—…ì í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('businessPhone').value = '';
            document.getElementById('businessLicense').value = '';
            hideValidation('businessPhoneValidation');
            hideValidation('businessValidation');
            validationStatus.businessPhone = false;
            validationStatus.businessLicense = false;
        }
    }

    function showStatus(message, type = 'info') {
        const statusDiv = document.getElementById('statusDiv');
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        console.log(`[${type.toUpperCase()}] ${message}`);
        setTimeout(() => statusDiv.innerHTML = '', 8000);
    }

    function handleKakaoLogin() {
        console.log('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œì‘...');

        if (!kakaoInitialized) {
            showStatus('ì¹´ì¹´ì˜¤ SDKê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        if (!Kakao.isInitialized()) {
            showStatus('ì¹´ì¹´ì˜¤ SDKê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
            return;
        }

        try {
            Kakao.Auth.login({
                success: function(authObj) {
                    console.log('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ:', authObj);
                    currentAccessToken = authObj.access_token;
                    document.getElementById('tokenStatus').textContent = 'ì¹´ì¹´ì˜¤ í† í° íšë“';
                    showStatus('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ! ë°±ì—”ë“œë¡œ í† í° ì „ì†¡ ì¤‘...', 'success');
                    sendTokenToBackend(authObj.access_token);
                },
                fail: function(err) {
                    console.error('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨:', err);
                    showStatus('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (err.error_description || JSON.stringify(err)), 'error');
                }
            });
        } catch (error) {
            console.error('ë¡œê·¸ì¸ í•¨ìˆ˜ ì‹¤í–‰ ì˜¤ë¥˜:', error);
            showStatus('ë¡œê·¸ì¸ í•¨ìˆ˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // ì¤‘ë³µ í™•ì¸ í•¨ìˆ˜ë“¤
    async function checkNickname() {
        const nickname = document.getElementById('nickname').value.trim();
        if (!nickname) {
            showValidation('nicknameValidation', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/nickname?nickname=${encodeURIComponent(nickname)}`);
            const data = await response.json();

            if (data.data) {
                showValidation('nicknameValidation', 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.', 'success');
                validationStatus.nickname = true;
            } else {
                showValidation('nicknameValidation', 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.', 'error');
                validationStatus.nickname = false;
            }
        } catch (error) {
            showValidation('nicknameValidation', 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            validationStatus.nickname = false;
        }
    }

    async function checkPhone() {
        const phone = document.getElementById('phone').value.trim();
        if (!phone) {
            showValidation('phoneValidation', 'ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        if (!/^01[0-9]{8,9}$/.test(phone)) {
            showValidation('phoneValidation', 'ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/phone?phone=${encodeURIComponent(phone)}`);
            const data = await response.json();

            if (data.data) {
                showValidation('phoneValidation', 'ì‚¬ìš© ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'success');
                validationStatus.phone = true;
            } else {
                showValidation('phoneValidation', 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'error');
                validationStatus.phone = false;
            }
        } catch (error) {
            showValidation('phoneValidation', 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            validationStatus.phone = false;
        }
    }

    async function checkBusinessPhone() {
        const phone = document.getElementById('businessPhone').value.trim();
        if (!phone) {
            showValidation('businessPhoneValidation', 'ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        if (!/^01[0-9]{8,9}$/.test(phone)) {
            showValidation('businessPhoneValidation', 'ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/phone?phone=${encodeURIComponent(phone)}`);
            const data = await response.json();

            if (data.data) {
                showValidation('businessPhoneValidation', 'ì‚¬ìš© ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'success');
                validationStatus.businessPhone = true;
            } else {
                showValidation('businessPhoneValidation', 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'error');
                validationStatus.businessPhone = false;
            }
        } catch (error) {
            showValidation('businessPhoneValidation', 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            validationStatus.businessPhone = false;
        }
    }

    async function checkBusinessLicense() {
        const businessLicense = document.getElementById('businessLicense').value.trim();
        if (!businessLicense) {
            showValidation('businessValidation', 'ì‚¬ì—…ì ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        if (!/^\d{3}-\d{2}-\d{5}$|^\d{10}$/.test(businessLicense)) {
            showValidation('businessValidation', 'ì˜¬ë°”ë¥¸ ì‚¬ì—…ì ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/businessLicense?businessLicenseNumber=${encodeURIComponent(businessLicense)}`);
            const data = await response.json();

            if (data.data) {
                showValidation('businessValidation', 'ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ì—…ì ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'success');
                validationStatus.businessLicense = true;
            } else {
                showValidation('businessValidation', 'ì´ë¯¸ ë“±ë¡ëœ ì‚¬ì—…ì ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'error');
                validationStatus.businessLicense = false;
            }
        } catch (error) {
            console.warn('ì‚¬ì—…ì ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜:', error);
            showValidation('businessValidation', 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            validationStatus.businessLicense = false;
        }
    }

    function showValidation(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = `validation-message ${type}`;
        element.style.display = 'block';
    }

    function hideValidation(elementId) {
        const element = document.getElementById(elementId);
        element.style.display = 'none';
    }

    async function sendTokenToBackend(accessToken) {
        try {
            showStatus('ê¸°ì¡´ íšŒì› í™•ì¸ ì¤‘...', 'info');
            console.log('ë°±ì—”ë“œ ë¡œê·¸ì¸ ìš”ì²­ ì‹œì‘...');

            const loginResponse = await fetch('http://localhost:8080/api/auth/login/member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    accessToken: accessToken
                })
            });

            console.log('ë°±ì—”ë“œ ì‘ë‹µ ìƒíƒœ:', loginResponse.status);

            if (loginResponse.ok) {
                const loginData = await loginResponse.json();
                console.log('ë¡œê·¸ì¸ ì„±ê³µ ë°ì´í„°:', loginData);
                showStatus('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                handleLoginSuccess(loginData.data);
            } else {
                const errorData = await loginResponse.json();
                console.log('ë¡œê·¸ì¸ ì‹¤íŒ¨ (ì‹ ê·œ íšŒì›):', errorData);
                showStatus('ì‹ ê·œ íšŒì›ì…ë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.', 'info');
                showSignupSection();
            }
        } catch (error) {
            console.error('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
            showStatus('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    function showSignupSection() {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('signupSection').classList.remove('hidden');
        document.getElementById('userSection').classList.add('hidden');
    }

    async function signupUser() {
        if (!currentAccessToken) {
            showStatus('ì¹´ì¹´ì˜¤ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }

        try {
            showStatus('íšŒì›ê°€ì… ì¤‘...', 'info');

            let requestData;
            let apiUrl;

            if (selectedMemberType === 'user') {
                // ê°œì¸ íšŒì› ê°€ì…
                const nickname = document.getElementById('nickname').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const address = document.getElementById('address').value.trim();

                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                if (!nickname) {
                    showStatus('ë‹‰ë„¤ì„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                    return;
                }

                if (!address) {
                    showStatus('ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                    return;
                }

                // ì¤‘ë³µ í™•ì¸ ì—¬ë¶€ ê²€ì¦
                if (!validationStatus.nickname) {
                    showStatus('ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                if (phone && !validationStatus.phone) {
                    showStatus('ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                requestData = {
                    accessToken: currentAccessToken,
                    nickname: nickname,
                    phone: phone || null,
                    address: address
                };

                apiUrl = 'http://localhost:8080/api/auth/signup/member';

            } else {
                // ì‚¬ì—…ì íšŒì› ê°€ì…
                const phone = document.getElementById('businessPhone').value.trim();
                const businessLicense = document.getElementById('businessLicense').value.trim();

                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                if (!businessLicense) {
                    showStatus('ì‚¬ì—…ì ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                    return;
                }

                // ì¤‘ë³µ í™•ì¸ ì—¬ë¶€ ê²€ì¦
                if (!validationStatus.businessLicense) {
                    showStatus('ì‚¬ì—…ì ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                if (phone && !validationStatus.businessPhone) {
                    showStatus('ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                requestData = {
                    accessToken: currentAccessToken,
                    businessLicenseNumber: businessLicense,
                    phone: phone || null
                };

                apiUrl = 'http://localhost:8080/api/auth/signup/store';
            }

            console.log('íšŒì›ê°€ì… ìš”ì²­ ë°ì´í„°:', requestData);

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            console.log('íšŒì›ê°€ì… ì‘ë‹µ ìƒíƒœ:', response.status);

            if (response.ok) {
                const data = await response.json();
                console.log('íšŒì›ê°€ì… ì„±ê³µ:', data);
                showStatus('íšŒì›ê°€ì… ì„±ê³µ!', 'success');
                handleLoginSuccess(data.data);
            } else {
                const errorData = await response.json();
                console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', errorData);
                showStatus('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + (errorData.message || errorData.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            }
        } catch (error) {
            console.error('íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
            showStatus('íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    function handleLoginSuccess(userData) {
        localStorage.setItem('accessToken', userData.accessToken);
        localStorage.setItem('refreshToken', userData.refreshToken);
        localStorage.setItem('userInfo', JSON.stringify(userData));

        document.getElementById('tokenStatus').textContent = 'JWT í† í° ì €ì¥ ì™„ë£Œ';
        showUserSection(userData);
    }

    function showUserSection(userData) {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('signupSection').classList.add('hidden');
        document.getElementById('userSection').classList.remove('hidden');

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        const memberTypeText = userData.role === 'ROLE_STORE' ? 'ğŸª ì‚¬ì—…ì íšŒì›' : 'ğŸ‘¤ ê°œì¸ íšŒì›';
        const businessInfo = userData.role === 'ROLE_STORE' && userData.businessLicenseNumber
            ? `<p><strong>ì‚¬ì—…ì ë²ˆí˜¸:</strong> ${userData.businessLicenseNumber}</p>`
            : '';
        const businessApprovalInfo = userData.role === 'ROLE_STORE'
            ? `<p><strong>ì‚¬ì—…ì ìŠ¹ì¸ ìƒíƒœ:</strong> ${userData.isBusinessApproved || 'ë¯¸ìŠ¹ì¸'}</p>`
            : '';

        const userInfoHtml = `
            <p><strong>ID:</strong> ${userData.id}</p>
            <p><strong>íšŒì› ìœ í˜•:</strong> ${memberTypeText}</p>
            <p><strong>ì´ë©”ì¼:</strong> ${userData.email}</p>
            <p><strong>ë‹‰ë„¤ì„:</strong> ${userData.nickname || 'ì—†ìŒ'}</p>
            <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${userData.phone || 'ì—†ìŒ'}</p>
            ${businessInfo}
            ${businessApprovalInfo}
            <p><strong>í™˜ê²½ ë ˆë²¨:</strong> ${userData.environmentLevel}</p>
            <p><strong>ì£¼ì†Œ:</strong> ${userData.location ? userData.location.address : 'ì—†ìŒ'}</p>
        `;
        document.getElementById('userInfo').innerHTML = userInfoHtml;
    }

    async function logout() {
        try {
            const accessToken = localStorage.getItem('accessToken');

            if (accessToken) {
                const response = await fetch('http://localhost:8080/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    }
                });
                console.log('ë°±ì—”ë“œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ:', response.status);
            }

            // ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ
            if (kakaoInitialized && typeof Kakao !== 'undefined' && Kakao.Auth) {
                try {
                    Kakao.Auth.logout();
                    console.log('ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                } catch (logoutError) {
                    console.warn('ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', logoutError);
                }
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('userInfo');
            currentAccessToken = null;

            // ìƒíƒœ ì´ˆê¸°í™”
            selectedMemberType = 'user';
            validationStatus = {
                nickname: false,
                phone: false,
                businessPhone: false,
                businessLicense: false
            };

            // UI ì´ˆê¸°í™”
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('signupSection').classList.add('hidden');
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('tokenStatus').textContent = 'ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ';

            // í¼ ì´ˆê¸°í™”
            document.getElementById('nickname').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('address').value = '';
            document.getElementById('businessPhone').value = '';
            document.getElementById('businessLicense').value = '';

            // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.radio-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector('.radio-item').classList.add('selected');
            document.querySelector('input[name="memberType"][value="user"]').checked = true;

            // í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€ ì´ˆê¸°í™”
            document.getElementById('businessFields').classList.remove('show');
            document.getElementById('userFields').classList.remove('hide');

            // ê²€ì¦ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            hideValidation('nicknameValidation');
            hideValidation('phoneValidation');
            hideValidation('businessPhoneValidation');
            hideValidation('businessValidation');

            showStatus('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'success');
        } catch (error) {
            console.error('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
            showStatus('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // SDK ìƒíƒœ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
    function testSdkStatus() {
        const result = {
            sdkLoaded: typeof Kakao !== 'undefined',
            sdkInitialized: kakaoInitialized,
            kakaoVersion: typeof Kakao !== 'undefined' ? Kakao.VERSION : 'N/A',
            authObject: typeof Kakao !== 'undefined' && Kakao.Auth ? 'Available' : 'Not Available',
            authMethods: typeof Kakao !== 'undefined' && Kakao.Auth ? Object.keys(Kakao.Auth) : [],
            loginMethod: typeof Kakao !== 'undefined' && Kakao.Auth && typeof Kakao.Auth.login === 'function' ? 'Available' : 'Not Available',
            authorizeMethod: typeof Kakao !== 'undefined' && Kakao.Auth && typeof Kakao.Auth.authorize === 'function' ? 'Available' : 'Not Available',
            currentToken: typeof Kakao !== 'undefined' && Kakao.Auth ? Kakao.Auth.getAccessToken() : null,
            memberType: selectedMemberType,
            validationStatus: validationStatus
        };

        showApiResult('SDK ìƒíƒœ í™•ì¸', result);
    }

    // API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function checkBackendHealth() {
        try {
            showStatus('ë°±ì—”ë“œ ì—°ê²° í™•ì¸ ì¤‘...', 'info');
            const response = await fetch('http://localhost:8080/api/auth/check/email?email=test@test.com');

            if (response.ok) {
                const data = await response.json();
                showApiResult('ë°±ì—”ë“œ ì—°ê²° ìƒíƒœ', { status: 'OK', response: data });
                showStatus('ë°±ì—”ë“œ ì—°ê²° ì •ìƒ', 'success');
            } else {
                showApiResult('ë°±ì—”ë“œ ì—°ê²° ìƒíƒœ', { status: 'ERROR', statusCode: response.status });
                showStatus('ë°±ì—”ë“œ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status, 'error');
            }
        } catch (error) {
            showApiResult('ë°±ì—”ë“œ ì—°ê²° ìƒíƒœ', { status: 'FAILED', error: error.message });
            showStatus('ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
        }
    }

    async function testNicknameCheck() {
        const nickname = prompt('í™•ì¸í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (!nickname) return;

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/nickname?nickname=${encodeURIComponent(nickname)}`);
            const data = await response.json();
            showApiResult('ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸', data);
        } catch (error) {
            showApiResult('ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜', { error: error.message });
        }
    }

    async function testPhoneCheck() {
        const phone = prompt('í™•ì¸í•  ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!phone) return;

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/phone?phone=${encodeURIComponent(phone)}`);
            const data = await response.json();
            showApiResult('ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸', data);
        } catch (error) {
            showApiResult('ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜', { error: error.message });
        }
    }

    async function testEmailCheck() {
        const email = prompt('í™•ì¸í•  ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (!email) return;

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/email?email=${encodeURIComponent(email)}`);
            const data = await response.json();
            showApiResult('ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸', data);
        } catch (error) {
            showApiResult('ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜', { error: error.message });
        }
    }

    async function testBusinessLicenseCheck() {
        const businessLicense = prompt('í™•ì¸í•  ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!businessLicense) return;

        try {
            const response = await fetch(`http://localhost:8080/api/auth/check/businessLicense?businessLicenseNumber=${encodeURIComponent(businessLicense)}`);
            const data = await response.json();
            showApiResult('ì‚¬ì—…ìë²ˆí˜¸ ì¤‘ë³µ í™•ì¸', data);
        } catch (error) {
            showApiResult('ì‚¬ì—…ìë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜', { error: error.message });
        }
    }

    async function testTokenRefresh() {
        const refreshToken = localStorage.getItem('refreshToken');
        if (!refreshToken) {
            showApiResult('í† í° ê°±ì‹  ì˜¤ë¥˜', { error: 'ì €ì¥ëœ Refresh Tokenì´ ì—†ìŠµë‹ˆë‹¤.' });
            return;
        }

        try {
            const response = await fetch('http://localhost:8080/api/auth/refresh', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    refreshToken: refreshToken
                })
            });
            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('accessToken', data.data.accessToken);
                localStorage.setItem('refreshToken', data.data.refreshToken);
                showStatus('í† í° ê°±ì‹  ì„±ê³µ', 'success');
            }

            showApiResult('í† í° ê°±ì‹ ', data);
        } catch (error) {
            showApiResult('í† í° ê°±ì‹  ì˜¤ë¥˜', { error: error.message });
        }
    }

    function showApiResult(title, data) {
        const resultDiv = document.getElementById('apiResult');
        resultDiv.innerHTML = `
            <h4>${title} ê²°ê³¼:</h4>
            <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
    }
</script>
</body>
</html>